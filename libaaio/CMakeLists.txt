execute_process(
  COMMAND ${CMAKE_COMMAND} -E tar jxf ${CMAKE_CURRENT_SOURCE_DIR}/libaaio-0.3.1.tar.bz2
  WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
  RESULT_VARIABLE TAR_RETURN
  ERROR_VARIABLE TAR_STDERR
)

if (TAR_RETURN)
  message(FATAL_ERROR ${TAR_STDERR})
endif()

set(LIBAAIO_DIR ${CMAKE_CURRENT_SOURCE_DIR}/libaaio-0.3.1)

file(MAKE_DIRECTORY ${LIBRARY_INSTALL_DIR})

ExternalProject_Add(
  libaaio
  SOURCE_DIR ${LIBAAIO_DIR}
  PREFIX ${LIBAAIO_DIR}
  CONFIGURE_COMMAND ${LIBAAIO_DIR}/configure --prefix=${LIBAAIO_DIR}
  BUILD_COMMAND make
  INSTALL_COMMAND cmake -E copy ${LIBAAIO_DIR}/.libs/libaaio.a ${LIBRARY_INSTALL_DIR}/libaaio.a
  BUILD_IN_SOURCE 1
)